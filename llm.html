<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.0/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.0/ext-language_tools.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/11.1.0/marked.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { display: flex; height: 100vh; background: #121212; color: white; }
        #sidebar { width: 250px; background: #1e1e1e; padding: 15px; display: flex; flex-direction: column; }
        #sidebar h3 { margin-bottom: 10px; }
        #prompt { width: 100%; padding: 10px; margin-bottom: 10px; background: #333; color: white; border: none; }
        #ask-btn { padding: 10px; background: #007bff; border: none; color: white; cursor: pointer; }
        #ask-btn:hover { background: #0056b3; }
        #editor-container { flex: 1; display: flex; flex-direction: column; padding: 20px; position: relative; }
        #editor { width: 100%; height: 400px; border: 1px solid #444; border-radius: 10px; }
        #copy-btn {
            position: absolute;
            top: 10px;
            right: 20px;
            background: none;
            border: none;
            cursor: pointer;
            width: 30px;
            height: 30px;
        }
        #copy-btn svg {
            width: 30px;
            height: 30px;
            fill: white;
        }
        #copy-btn:hover svg {
            fill: #007bff;
        }
        #response-box {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background: #1e1e1e;
            border: 1px solid #444;
            min-height: 100px;
            max-height: 250px;
            border-radius: 20px;
            overflow-y: auto;
            position: relative;
        }
        #response-content {
            width: 70%;
            height: 90%;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <h3>Type your prompt</h3>
        <input type="text" id="prompt" placeholder="Ask for code...">
        <button id="ask-btn" onclick="askGemini()">Ask AI</button>
    </div>
    <div id="editor-container">
        <h2 style="margin: 10px;">Code Editor</h2>
        <button id="copy-btn" onclick="copyToClipboard()">
            <svg viewBox="0 0 24 24">
                <path d="M16 1H4c-1.1 0-2 .9-2 2v16h2V3h12V1zM19 5H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path>
            </svg>
        </button>
        <div id="editor"></div>
        <h3 style="margin: 10px;">Explanation</h3>
        <div id="response-box">
            <div id="response-content"></div>
        </div>
    </div>
    <script>
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/github_dark");
        editor.session.setMode("ace/mode/javascript");
        editor.setOptions({
            enableBasicAutocompletion: true,
            enableLiveAutocompletion: true,
            enableSnippets: true
        });

        const supportedLanguages = {
            "javascript": "javascript",
            "python": "python",
            "java": "java",
            "c": "c_cpp",
            "c++": "c_cpp",
            "c#": "csharp",
            "html": "html",
            "css": "css",
            "php": "php",
            "typescript": "typescript",
            "swift": "swift",
            "go": "golang",
            "ruby": "ruby",
            "rust": "rust"
        };

        const GEMINI_API_KEY = "AIzaSyAGDighnmGYQfXhKlql6W3AKKpDtMlYCas";

        async function askGemini() {
            const prompt = document.getElementById("prompt").value;
            if (!prompt) return alert("Please enter a prompt!");

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ 
                        contents: [{ parts: [{ 
                            text: `You are a specialized AI assistant that generates programming code. Follow the rules below:
                            
**Rules:**  
1. Return output **strictly** in **JSON format** inside a code block (\`\`\`json ... \`\`\`).  
2. **Supported Languages Only:** Choose from this list:  
   - javascript, python, java, c, c++, c#, html, css, php, typescript, swift, go, ruby, rust  
3. **Use Only One Language Name**: Ensure the "language" field contains exactly one from the list above.  
4. **JSON Structure:**  
\`\`\`json
{
    "code": "<valid_code_here>",
    "response": "<brief_explanation_here>",
    "language": "<one_supported_language_here>"
}
\`\`\`

**Task:**  
Write a program for the following request: "${prompt}" strictly following the format above.`
                        }] }] 
                    })
                });

                const data = await response.json();
                let aiText = data?.candidates?.[0]?.content?.parts?.[0]?.text || "";
                let jsonString = aiText.replace(/```json/g, "").replace(/```/g, "").trim();
                let aiResponse = JSON.parse(jsonString);

                let detectedLanguage = aiResponse.language?.toLowerCase() || "javascript";
                if (supportedLanguages[detectedLanguage]) {
                    editor.session.setMode(`ace/mode/${supportedLanguages[detectedLanguage]}`);
                }

                typeCode(aiResponse.code || "// No code provided");
                document.getElementById("response-content").innerHTML = marked.parse(aiResponse.response || "No explanation provided.");
                document.getElementById("response-box").scrollTop = document.getElementById("response-box").scrollHeight;

            } catch (error) {
                console.error("Error fetching AI response:", error);
                alert("Failed to fetch response from Gemini API.");
            }
        }

        function typeCode(code) {
            editor.setValue(""); 
            let index = 0;
            editor.setReadOnly(true);
            editor.selection.clearSelection();

            function type() {
                if (index < code.length) {
                    editor.setValue(code.substring(0, index + 1), 1);
                    let line = (code.substring(0, index + 1).match(/\n/g) || []).length + 1;
                    let column = (index + 1) - code.lastIndexOf("\n", index);
                    editor.gotoLine(line, column);
                    editor.renderer.scrollToLine(line);
                    index++;
                    setTimeout(type, 0);
                } else {
                    editor.setReadOnly(false);
                }
            }

            type();
        }

        function copyToClipboard() {
            navigator.clipboard.writeText(editor.getValue())
                .then(() => alert("Code copied to clipboard!"));
        }
    </script>
</body>
</html>
